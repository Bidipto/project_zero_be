<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WebSocket Test</title>
    <style>
        body { font-family: sans-serif; }
        #messages { border: 1px solid #ccc; padding: 10px; margin-top: 10px; height: 300px; overflow-y: scroll; }
    </style>
</head>
<body>
    <h1>WebSocket Test UI</h1>
    <div>
        <label for="chat_id">Chat ID:</label>
        <input type="text" id="chat_id" value="7">
    </div>
    <div>
        <label for="token">JWT Token:</label>
        <input type="text" id="token" size="100" value="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJzdWIiOiI2IiwidXNlcm5hbWUiOiJ0ZXN0dXNlcl93c18xIiwiZW1haWwiOiJ0ZXN0dXNlcl93c18xQGV4YW1wbGUuY29tIiwiZXhwIjoxNzU0NTk4OTI2fQ.3wmQryBvUOQMBbjL9HyR2fSMduXeLfrR-Rl1Ft6PuLE">
    </div>
    <button id="connectBtn">Connect</button>
    <button id="disconnectBtn" disabled>Disconnect</button>
    <hr>
    <div>
        <label for="message">Message:</label>
        <input type="text" id="message" size="50" disabled>
        <button id="sendBtn" disabled>Send</button>
    </div>
    <div id="messages"></div>

    <script>
        const connectBtn = document.getElementById('connectBtn');
        const disconnectBtn = document.getElementById('disconnectBtn');
        const sendBtn = document.getElementById('sendBtn');
        const messageInput = document.getElementById('message');
        const messagesDiv = document.getElementById('messages');
        const chatIdInput = document.getElementById('chat_id');
        const tokenInput = document.getElementById('token');

        let websocket;

        function log(message) {
            const p = document.createElement('p');
            p.textContent = message;
            messagesDiv.appendChild(p);
            messagesDiv.scrollTop = messagesDiv.scrollHeight;
        }

        connectBtn.addEventListener('click', () => {
            const chatId = chatIdInput.value;
            // const token = tokenInput.value;
            if (!chatId || !token) {
                log('Chat ID and Token are required.');
                return;
            }

            const wsUri = `ws://localhost:8000/v1/chat/ws/${chatId}`;
            websocket = new WebSocket(wsUri);

            websocket.onopen = () => {
                log('Connected to WebSocket.');
                connectBtn.disabled = true;
                disconnectBtn.disabled = false;
                messageInput.disabled = false;
                sendBtn.disabled = false;
            };

            websocket.onmessage = (event) => {
                log(`Received: ${event.data}`);
            };

            websocket.onerror = (error) => {
                log(`WebSocket Error: ${error}`);
            };

            websocket.onclose = (event) => {
                let reason = event.reason ? `Reason: ${event.reason}` : 'No reason given';
                log(`Disconnected from WebSocket. Code: ${event.code}. ${reason}`);
                connectBtn.disabled = false;
                disconnectBtn.disabled = true;
                messageInput.disabled = true;
                sendBtn.disabled = true;
            };
        });

        disconnectBtn.addEventListener('click', () => {
            if (websocket) {
                websocket.close();
            }
        });

        sendBtn.addEventListener('click', () => {
            const message = messageInput.value;
            if (websocket && websocket.readyState === WebSocket.OPEN && message) {
                websocket.send(message);
                log(`Sent: ${message}`);
                messageInput.value = '';
            }
        });
    </script>
</body>
</html>